<!DOCTYPE html>
<html lang="vni">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIKIDO AISHINKAN VIET NAM - Sự kiện</title>
    <link rel="stylesheet" href="styles.css">
    <script src="../config/loadHeaderFooter.js" defer></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Thêm Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" defer></script>
    <style>
        
    </style>
</head>
<body>
        <div id="header"></div>
        <main>
            <div class="container py-5">
                <h1 class="text-center mb-5">Các Sự Kiện</h1>
                <div id="eventsList" class="row">
                    <!-- Các sự kiện sẽ được chèn vào đây bằng JavaScript -->
                </div>
            </div>
        </main>
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                const eventsList = document.getElementById('eventsList');
                
                // Lấy dữ liệu từ API
                fetch('https://localhost:7296/api/Posts')
                .then(response => response.json())
                .then(posts => {
                    if (posts.length === 0) {
                        eventsList.innerHTML = '<p class="text-center">Chưa có sự kiện nào được đăng.</p>';
                    } else {
                        posts.forEach(post => {
                            const eventElement = document.createElement('div');
                            eventElement.classList.add('col-md-4', 'mb-4', 'event-item');
                            
                            // Chuyển đổi ngày từ createdAt
                            const postDate = new Date(post.createdAt);
                            const formattedDate = postDate.toLocaleDateString('vi-VN', {
                                year: 'numeric',
                                month: 'long',
                                day: 'numeric'
                            });

                            // Lấy nội dung có order = 1 và type = "Text" từ API Contents/Post/{post.id}
                            fetch(`https://localhost:7296/api/Contents/Post/${post.id}`)
                                .then(response => response.json())
                                .then(contents => {
                                    // Tìm nội dung có order = 1 và type là "Text"
                                    const contentOrder1 = contents.find(content => content.order === 0 && content.type === "Text");
                                    const contentText = contentOrder1 ? contentOrder1.content : 'Chưa có nội dung cho sự kiện này.';

                                    // Tìm nội dung có order = 0 và type là "Image"
                                    const contentOrder0 = contents.find(content => content.order === 0 && content.type === "Image");
                                    const imageUrl = contentOrder0 ? contentOrder0.content : '';  // Nếu có, lấy content làm URL hình ảnh

                                    eventElement.innerHTML = `
                                        <div class="card h-100 shadow-sm">
                                            <div class="card-body">
                                                ${imageUrl ? `<img src="${imageUrl}" alt="Event Image" class="card-img-top" />` : ''} <!-- Hiển thị ảnh nếu có -->
                                                <h5 class="card-title">${post.title}</h5>
                                                <p><strong>Ngày:</strong> ${formattedDate}</p>
                                                <p class="card-text"><strong>Nội dung:</strong> ${contentText}</p> <!-- Hiển thị nội dung có order 1 và type = "Text" -->
                                                <a href="post-details.html?id=${post.id}" class="btn btn-primary">Xem chi tiết</a>
                                            </div>
                                        </div>
                                    `;
                                    eventsList.appendChild(eventElement);
                                })
                                .catch(error => {
                                    console.error('Lỗi khi tải nội dung bài viết:', error);
                                });
                        });
                    }
                })
                .catch(error => {
                    console.error('Lỗi khi tải các sự kiện:', error);
                    eventsList.innerHTML = '<p class="text-center">Không thể tải sự kiện. Vui lòng thử lại sau.</p>';
                });


            });
        </script>
        <div id="footer"></div>
</body>
</html>
